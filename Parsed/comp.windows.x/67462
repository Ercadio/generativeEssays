From Duncan Sinclair Subject Glasgow RX remote execution of X programs I posted this a few weeks back but all I got back was an error message pnews dev null Permission denied Yep dev null had a mode of Arrghhh With renewed interest in setting the DISPLAY variable I thought I would post my This Perl script is my It trys to be intelligent about what it's doing so that you should be able to type rx and get a xterm running on with all the difficult stuff taken care In theory this program can do everything you ever wanted to do when you wanted to run a remote command in the background it doesn't even need to be an X Try a rx big machine make for instance for a backgrounded make on the remote big machine For more details and a full list of features read the README file about lines All comments bin sh This is a shell Remove anything before this line then unpack it by saving it into a file and typing sh file To overwrite existing files type sh file c You can also feed this as standard input via unshar or by typing sh file If this archive is complete you will see the following message at the end End of archive of Contents README Imakefile MANIFEST Makefile Wrapped by on Thu Apr PATH bin usr bin usr ucb export PATH if test f 'README' a c then echo shar Will not clobber existing file 'README' else echo shar Extracting 'README' characters sed s X 'README' 'END OF FILE' X X Glasgow RX remote execution of X Version X XCopyright Duncan Sinclair X XTrivial to install but there's an Imakefile to make it even more X XThe perl script needs some customisation before it is installed just Xedit the file and read the Once you've done Xthis you can xmkmf then make install X XFEATURES X X Does the right thing for off site remote Including X setting up DISPLAY to include domain names and passing X magic cookies or doing the xhost X X Allow different remote user rx l user host X X Smart quoting of arguments makes passing wild cards X X Custom command execution link it to remacs to get a remote X emacs X X Automatic xterm options names the xterm according to hostname X and turns on login shell X X Default command is X X Propagates X ish variables to remote session user may X extend the list of variables to X X Special handling for bourne shell X X Tries to do remote execution from same directory as X That is it propagates PWD in an intelligent X X Logs errors in a X X Overall Intelligence TM makes reasoned decisions about what X you are trying to do and tries to do the right thing X X Written in Perl for portability and X XFor more info read the man page or the X END OF FILE if test ne wc c 'README' then echo shar 'README' unpacked with wrong size fi end of 'README' fi if test f 'Imakefile' a c then echo shar Will not clobber existing file 'Imakefile' else echo shar Extracting 'Imakefile' characters sed s X 'Imakefile' 'END OF FILE' X Glasgow RX X X PROGRAMS rx X Xall PROGRAMS X Xinstall safe X XInstallNamedProg rx BINDIR XInstallManPage rx MANDIR X Xinstall X RM BINDIR rxterm X LN BINDIR rx BINDIR rxterm X Xsafe X grep s 'debug ' false X Xshar safe X makekit m p X perl pi e s Part X END OF FILE if test ne wc c 'Imakefile' then echo shar 'Imakefile' unpacked with wrong size fi end of 'Imakefile' fi if test f 'MANIFEST' a c then echo shar Will not clobber existing file 'MANIFEST' else echo shar Extracting 'MANIFEST' characters sed s X 'MANIFEST' 'END OF FILE' X File Name Archive Description X X README Read me first X Imakefile X MANIFEST This shipping list X Makefile X X END OF FILE if test ne wc c 'MANIFEST' then echo shar 'MANIFEST' unpacked with wrong size fi end of 'MANIFEST' fi if test f 'Makefile' a c then echo shar Will not clobber existing file 'Makefile' else echo shar Extracting 'Makefile' characters sed s X 'Makefile' 'END OF FILE' X Makefile generated by imake do not edit X XConsortium v rws Exp X X The cpp used on this machine replaces all newlines and multiple tabs and X spaces in a macro expansion with a single Imake tries to compensate X for this but is not always X X X X Makefile generated from and tmp X XConsortium v rws Exp X X Platform specific parameters may be set in the appropriate vendor X configuration Site specific parameters should be set in the file X Full rebuilds are recommended if any parameters are X X If your C preprocessor does not define any unique symbols you will need X to set BOOTSTRAPCFLAGS when rebuilding imake usually when doing X make World the first time X X X X site specific configuration parameters that need to come before X the platform specific parameters edit to change X X site XConsortium v rws Exp X X X platform specific configuration parameters edit to change X X platform XConsortium v rws Exp X X operating system SunOS X X XConsortium v rws Exp X X X site specific configuration parameters that go after X the platform specific parameters edit to change X X site XConsortium v rws Exp X X SHELL bin sh X X TOP X CURRENT DIR X X AR ar cq X BOOTSTRAPCFLAGS X CC gcc fpcc struct return X AS as X X COMPRESS compress X CPP lib cpp STD CPP DEFINES X PREPROCESSCMD gcc fpcc struct return E STD CPP DEFINES X INSTALL install X LD ld X LINT lint X LINTLIBFLAG C X LINTOPTS axz X LN ln s X MAKE make X MV mv X CP cp X X RANLIB ranlib X RANLIBINSTFLAGS X X RM rm f X TROFF psroff X MSMACROS ms X TBL tbl X EQN eqn X STD INCLUDES X STD CPP DEFINES X STD DEFINES X EXTRA LOAD FLAGS X EXTRA LIBRARIES X TAGS ctags X X SHAREDCODEDEF DSHAREDCODE X SHLIBDEF DSUNSHLIB X X PROTO DEFINES X X INSTPGMFLAGS X X INSTBINFLAGS m X INSTUIDFLAGS m X INSTLIBFLAGS m X INSTINCFLAGS m X INSTMANFLAGS m X INSTDATFLAGS m X INSTKMEMFLAGS g kmem m X X PROJECTROOT usr X X TOP INCLUDES I INCROOT X X CDEBUGFLAGS X CCOPTIONS X X ALLINCLUDES INCLUDES EXTRA INCLUDES TOP INCLUDES STD INCLUDES X ALLDEFINES ALLINCLUDES STD DEFINES EXTRA DEFINES PROTO DEFINES DEFINES X CFLAGS CDEBUGFLAGS CCOPTIONS ALLDEFINES X LINTFLAGS LINTOPTS DLINT ALLDEFINES X X LDLIBS SYS LIBRARIES EXTRA LIBRARIES X X LDOPTIONS CDEBUGFLAGS CCOPTIONS LOCAL LDFLAGS L USRLIBDIR X X LDCOMBINEFLAGS X r X DEPENDFLAGS X X MACROFILE X RM CMD RM core errs tags TAGS MakeOut X X IMAKE DEFINES X X IRULESRC CONFIGDIR X IMAKE CMD IMAKE DUseInstalled I IRULESRC IMAKE DEFINES X X ICONFIGFILES IRULESRC IRULESRC X IRULESRC IRULESRC X IRULESRC MACROFILE EXTRA ICONFIGFILES X X X X Window System Build Parameters X XConsortium v rws Exp X X X X Window System make variables this need to be coordinated with rules X X PATHSEP X USRLIBDIR usr lib X BINDIR usr local bin X INCROOT usr include X BUILDINCROOT TOP X BUILDINCDIR BUILDINCROOT X BUILDINCTOP X INCDIR INCROOT X ADMDIR usr adm X LIBDIR USRLIBDIR X CONFIGDIR LIBDIR config X LINTLIBDIR USRLIBDIR lint X X FONTDIR LIBDIR fonts X XINITDIR LIBDIR xinit X XDMDIR LIBDIR xdm X TWMDIR LIBDIR twm X MANPATH usr man X MANSOURCEPATH MANPATH man X MANSUFFIX n X LIBMANSUFFIX X MANDIR MANSOURCEPATH MANSUFFIX X LIBMANDIR MANSOURCEPATH LIBMANSUFFIX X NLSDIR LIBDIR nls X PEXAPIDIR LIBDIR PEX X XAPPLOADDIR LIBDIR app defaults X FONTCFLAGS t X X INSTAPPFLAGS INSTDATFLAGS X X IMAKE imake X DEPEND makedepend X RGB rgb X X FONTC bdftopcf X X MKFONTDIR mkfontdir X MKDIRHIER bin sh BINDIR mkdirhier X X CONFIGSRC TOP config X DOCUTILSRC TOP doc util X CLIENTSRC TOP clients X DEMOSRC TOP demos X LIBSRC TOP lib X FONTSRC TOP fonts X INCLUDESRC TOP X SERVERSRC TOP server X UTILSRC TOP util X SCRIPTSRC UTILSRC scripts X EXAMPLESRC TOP examples X CONTRIBSRC TOP contrib X DOCSRC TOP doc X RGBSRC TOP rgb X DEPENDSRC UTILSRC makedepend X IMAKESRC CONFIGSRC X XAUTHSRC LIBSRC Xau X XLIBSRC LIBSRC X X XMUSRC LIBSRC Xmu X TOOLKITSRC LIBSRC Xt X AWIDGETSRC LIBSRC Xaw X OLDXLIBSRC LIBSRC oldX X XDMCPLIBSRC LIBSRC Xdmcp X BDFTOSNFSRC FONTSRC bdftosnf X BDFTOSNFSRC FONTSRC clients bdftosnf X BDFTOPCFSRC FONTSRC clients bdftopcf X MKFONTDIRSRC FONTSRC clients mkfontdir X FSLIBSRC FONTSRC lib fs X FONTSERVERSRC FONTSRC server X EXTENSIONSRC TOP extensions X XILIBSRC EXTENSIONSRC lib xinput X PEXLIBSRC EXTENSIONSRC lib PEXlib X PHIGSLIBSRC EXTENSIONSRC lib PEX X X XConsortium v rws Exp X XSHLIBLDFLAGS assert pure text XPICFLAGS fpic X X DEPEXTENSIONLIB X EXTENSIONLIB lXext X X DEPXLIB DEPEXTENSIONLIB X XLIB EXTENSIONLIB X X DEPXMULIB USRLIBDIR SOXMUREV X XMULIBONLY lXmu X XMULIB lXmu X X DEPOLDXLIB X OLDXLIB loldX X X DEPXTOOLLIB USRLIBDIR SOXTREV X XTOOLLIB lXt X X DEPXAWLIB USRLIBDIR SOXAWREV X XAWLIB lXaw X X DEPXILIB X XILIB lXi X X DEPPEXLIB X PEXLIB X X SOXLIBREV X SOXTREV X SOXAWREV X SOOLDXREV X SOXMUREV X SOXEXTREV X SOXINPUTREV X SOPEXREV X X DEPXAUTHLIB USRLIBDIR X XAUTHLIB lXau X DEPXDMCPLIB USRLIBDIR X XDMCPLIB lXdmcp X X DEPPHIGSLIB USRLIBDIR X PHIGSLIB lphigs X X DEPXBSDLIB USRLIBDIR X XBSDLIB lXbsd X X LINTEXTENSIONLIB LINTLIBDIR llib X LINTXLIB LINTLIBDIR llib X LINTXMU LINTLIBDIR llib X LINTXTOOL LINTLIBDIR llib X LINTXAW LINTLIBDIR llib X LINTXI LINTLIBDIR llib X LINTPEX LINTLIBDIR llib X LINTPHIGS LINTLIBDIR llib X X DEPLIBS DEPXAWLIB DEPXMULIB DEPXTOOLLIB DEPXLIB X X DEPLIBS X DEPLIBS X DEPLIBS X X X Imake rules for building libraries programs scripts and data files X rules XConsortium v rws Exp X X X start of Imakefile X X Glasgow RX X X PROGRAMS rx X Xall PROGRAMS X Xinstall safe X Xinstall X if d DESTDIR BINDIR then set x X else set x MKDIRHIER DESTDIR BINDIR fi X INSTALL c INSTBINFLAGS DESTDIR BINDIR rx X X if d DESTDIR MANDIR then set x X else set x MKDIRHIER DESTDIR MANDIR fi X INSTALL c INSTMANFLAGS DESTDIR MANDIR MANSUFFIX X Xinstall X RM BINDIR rxterm X LN BINDIR rx BINDIR rxterm X Xsafe X grep s 'debug ' false X Xshar safe X makekit m p X perl pi e s Part X X X common rules for all Makefiles do not edit X Xemptyrule X Xclean X RM CMD X XMakefile X if f Makefile then set x X RM MV Makefile X else exit fi X IMAKE CMD DTOPDIR TOP DCURDIR CURRENT DIR X Xtags X TAGS w ch X TAGS xw ch TAGS X Xsaber X load ALLDEFINES SRCS X Xosaber X load ALLDEFINES OBJS X X X empty rules for directories that do not have SUBDIRS do not edit X Xinstall X echo install in CURRENT DIR done X X echo in CURRENT DIR done X XMakefiles X Xincludes X X X dependencies generated by makedepend X END OF FILE if test ne wc c 'Makefile' then echo shar 'Makefile' unpacked with wrong size fi end of 'Makefile' fi if test f ' ' a c then echo shar Will not clobber existing file ' ' else echo shar Extracting ' ' characters sed s X ' ' 'END OF FILE' RX March X Version NAME Xrx rxterm r remote command xterm anything execution SYNOPSIS rx X l username X host X command X rxterm X l username X host X args X DESCRIPTION XThe rx Xprogram connect to the specified host Xand executes the specified command Xin the background returning To allow the execution Xof X programs it copies a number of environmental variables to Xthe remote If you omit command Xthen rx will start an xterm on the remote The rxterm Xvarient starts a remote xterm on a host and also passes args Xto the remote xterm as XShell metacharacters which are not quoted are interpreted on the local Xmachine while quoted metacharacters are interpreted on the remote XIf the name of the file from which rx Xis executed is anything other than rx '' rx Xtakes this name stripped on a leading r'' as the command Xto run on the remote host using any command Xparameters as arguments for the remote XIf rx Xthinks you are using xauth Xbased X authorisation and you are calling to a off site host or Xto a different username it will attempt to copy an authorization Xkey to the remote Otherwise it will try to use xhost Xto grant access to the remote OPTIONS l username XUse username Xas the remote username instead of your local In the absence Xof this option the remote username is the same as your local X ENVIRONMENT XIf set the values of PATH DISPLAY XENVIRONMENT XAPPLRESDIR XXFILESEARCHPATH XUSERFILESEARCHPATH OPENWINHOME LD LIBRARY PATH Xand XAUTHORITY are exported to the remote program unless the Xremote username is different or the remote host is off site in which Xcase only DISPLAY is exported with in all cases any variables named in the Xvariable XThe DISPLAY variable is tweaked as appropriate to contain as qualified Xa hostname as is DIAGNOSTICS command don't recognise my rx Xcannot decode the name it has been called In this case Xit prints a warning message and continues as rx usage rx l username hostname XThis means it could not decode the arguments given to AUTHOR XDuncan Sinclair July XOriginally based on a program with the same name from the gwm To distinguish this rx from other programs Xwith similar names you should refer to this program as the Glasgow rx SEE ALSO XX rsh xterm xauth xhost gwm BUGS Rx Xmakes a number of assumptions about the relationship between the Xlocal user and the remote one depending on whether the remote Xhost is onsite or not and whether an alternative username was used Xor XIn particular if either the locally used shell or the remotely Xused shell is the standard Bourne Shell sh Xthen strange things are more likely to Especially when Xit's only one of XSometimes quoting can get messed XIt's too easy to fool the smarts in rx Xto make it believe something that is not true and fail because of XWhen rx Xuses xhost Xto grant access the xhost Xcommand may fail XIf rx Xtries to send to large a command to the remote machine it will Xlikely fail with a parse error from If this happens you Xwill probably have to reduce the size of the exported END OF FILE if test ne wc c ' ' then echo shar ' ' unpacked with wrong size fi end of ' ' fi if test f ' ' a c then echo shar Will not clobber existing file ' ' else echo shar Extracting ' ' characters sed s X ' ' 'END OF FILE' X usr local bin perl X CONFIG change the line above to point to your copy of X X Glasgow RX version X X Copyright Duncan Sinclair X X Last Modified Early April X X Distribution limited as per the usual MIT X X remote execution of X Based on a script in an old version of X X To install put rx in your bin and make rxterm a link to X Some configuration will be necessary see CONFIG X X More and more this is less and less like the X X Major hacked to work for our my set up and also partly X re written to work with sh rather than X X Maybe I'll turn this into our first zsh script X X Looks like it turned into a perl script at some point big X X This code tries to be intelligent in the way it This means there X are tons of implicit assumptions about the environment it is run X These assumptions are all valid on the machines I use and in my X At the same time I try to make as few assumptions as possible X about the remote Here's a list of all the more tricky X That the remote machine has Linux X That RSHELL bin k sh remote shell bin k Make X If remote shell sh that PATH is Use csh X I pass a cookie to the remote machine if need be but does it X know what to do with a eat it X There must be X X Why am I using csh to run the remote commands Simply because it doesn't X interact badly with rsh and hang waiting for a file descriptor to X be I'd rather use zsh or bash or even perl but they are not X as universal as X X Xrequire X X What we called X X X s X X CONFIG X Change these variables to be your domain name and a pattern that X will match all variations on your domain You must include X those leading dots If your hostname includes your domain see X the code further down marked XXX X X DOM X DOMPAT sgow X X CONFIG X Change this to your value of BINDIR or set the variable to if X you think your users are smarter than X X XPATHS usr bin X X CONFIG X Make this the name of your remote shell X X RSH rsh X X end of CONFIG X X Some variables we'll no doubt use X X usage usage l username hostname n X RSHELL getpwuid bin sh X HOME ENV HOME getpwuid X XAUTH ENV XAUTHORITY HOME X LOGF X STUFF X debug X X Before anything else close This might stop rx hanging X due to rsh X Xclose STDIN X X do a l X Xif ARGV eq l X shift X User ARGV die usage X LUser l User X shift X X X Pick a host any X X MACH ARGV die usage Xshift X X Things to think about for the remote X X MACH s DOMPAT X OffSite MACH X X Where am I Seems we can't trust the dumb user to set HOSTNAME right X X HOSTNAME ENV HOSTNAME hostname Current Host X HOSTNAME hostname Current Host X HOSTNAME s n X X If all your hostnames include your domain comment out the next X Xif OffSite HOSTNAME HOSTNAME DOM XXX X X Now we know where we are and they are are they different X X Diff HOSTNAME ne MACH X X What is the display going to be X Danger Heavy Regular expressions X This needs to be re written to be modular and can so be extended to X support resetting host to unix as X X DISPLAY ENV DISPLAY X DISPLAY s DOMPAT X DISPLAY s unix d d HOSTNAME if Diff X DISPLAY s d d DOM if OffSite X ENV DISPLAY DISPLAY X X Here comes the hard bit in Quote our X Also have to quote To cope with csh braindamage X quotes are quoted thus ' ' '' X So for an arg foo'bar we get 'foo' ''bar' X Xforeach ARGV X s ' ' ' ' g X s ' ' X X X So what we doing X XPROG X if eq rx last PROG X if eq rxterm X unshift ARGV ls if Diff X unshift ARGV xterm ls n MACH X last PROG X X if r unshift ARGV last PROG X warn don't recognise my X X X If nothing else become an X Xif ARGV X unshift ARGV ls if Diff X unshift ARGV xterm ls n MACH X X X Some special considerations if we are not ourselves on the other X Xif OffSite User X X We want to pass a cookie X X if e XAUTH X X This is going to be unsecure as the cookie will appear in a number X of command line But at least it'll X This will need enhanced if we ever fix the code above to X set DISPLAY to when we return to the X X CooKie PATH PATH XPATHS xauth list DISPLAY X chop CooKie X CooKs split ' ' CooKie X shift CooKs X unshift STUFF xauth add DISPLAY CooKs if CooKs X else X X What a I hate doing X X system xhost MACH dev null dev null if Diff X X X We really only want to pass a value for X X VARS DISPLAY split ' ' ENV RXENV X else X X Some variables we wish to export X X VARS X DISPLAY X XENVIRONMENT X XFILESEARCHPATH X XUSERFILESEARCHPATH X XAPPLRESDIR X OPENWINHOME X LD LIBRARY PATH X MANPATH for rxman and bourne shell X XAUTHORITY X split ' ' ENV RXENV X X X Braindead bourne shell needs to be given a X We would rather not pass the current PATH because it might not work X on the destination I'd rather it was set by the user's X remote shell during the X Fortunately all my X programs are in an arch independant place and X so it shouldn't cos a problem X We check against RSHELL because they might be running another shell X differant from their login I know sounds weird but it's too X common round X I've also included ksh in the brain damage cos I can't see an easy way X to pass throught ENV ENV without it being too We only have X one person who has ksh as a login shell X Oh we are assuming that if it's bourne shell here then it's X bourne shell Much more important than this is that it it ISNT X bourne shell here it better not be bourne shell X X if RSHELL m k sh push VARS PATH X X X Validate PWD X Xsub validate pwd X local pwdstats dotstats X local pwd X X unless defined pwd return undef X unless dotstats stat return undef X unless pwdstats stat pwd return undef X if pwdstats ST DEV dotstats ST DEV X pwdstats ST INO dotstats ST INO return undef X pwd X X X Try and find a nice valid X XPRESENT X if PWD ENV PWD X FOOPWD PWD X FOOPWD s tmp mnt export X PWD validate pwd FOOPWD validate pwd PWD X X unless PWD X chop PWD pwd X FOOPWD PWD X FOOPWD s tmp mnt export X PWD validate pwd FOOPWD validate pwd PWD HOME X X X PWD s ' ' X X Try to find somewhere nice to live on the other X Xunless OffSite X unshift STUFF test d PWD cd PWD X X X Start building the full X Xforeach var VARS X val ENV var X unshift STUFF setenv var ' val ' X X X Some commands to do on the other X Xunshift STUFF set nonomatch only if we are using X X Build the remote X X REMOTE umask STUFF ARGV dev null LOGF X REMOTE s g X REMOTE REMOTE X X Build the arg list for the X X COMM RSH LUser MACH csh fc REMOTE X X Do it X Xif debug X print COMM n X else X exec COMM X X X Rsh doesn't return any indication of how it went over X on the other side but that's OK cos we aint going to X wait around to see what X Xexit X X tHe ENd END OF FILE if test ne wc c ' ' then echo shar ' ' unpacked with wrong size fi chmod x ' ' end of ' ' fi echo shar End of archive of cp dev null MISSING for I in do if test f ark I isdone then MISSING MISSING I fi done if test MISSING then echo You have the rm f ark isdone else echo You still need to unpack the following archives echo MISSING fi End of shell exit Duncan Sinclair Would the real UNIX Operating System please stand